@model Cms.Models.MultipleIndexModel
@using Cms.Models;


@{
    var count = 0;
    var pocitadlo = 0;
    List<dynamic> cartcount = new List<dynamic>();
    cartcount = (List<dynamic>)Session["cartitems"];
    var cartitems = "0";
    decimal cartsum = Session["cartsum"] == null ? (decimal)0.0 : Convert.ToDecimal(Session["cartsum"]);
    if ((cartcount != null))
    {
        cartitems = cartcount.Count.ToString();
    }
    var username = "";

    if (Session["username"] != null)
    {
        username = Session["username"].ToString();
    }

    var role = "";
    if (Session["role"] != null)
    {
        role = Session["role"].ToString();
    }

    List<dynamic> wishcount = new List<dynamic>();
    wishcount = (List<dynamic>)Session["wishitems"];
    var wishitems = "0";
    if ((wishcount != null))
    {
        wishitems = wishcount.Count.ToString();
    }
}

<!DOCTYPE html>
<html>
<head>
    <!-- Google Tag Manager -->
    @*<script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PMLLRNP');</script>*@
    <!-- End Google Tag Manager -->

    @foreach (var item in Model.SettingsModel.OrderBy(x => x.id))
    {
        <meta charset="utf-8" />
        <meta property="og:type" content="business.business">
        <meta property="og:title" content="@ViewBag.Title @Html.Raw(item.description)">
        if (ViewBag.Description == "")
        {
            ViewBag.Description = "Ponúkame klimatizácie, rekuperáciu, vzduchotechniku od preverených značiek. Zabezpečujeme montáž aj servis.";
        }
        <meta property="og:description" content="@ViewBag.Description">
        <meta property="og:url" content="@Request.Url.ToString()">
        <meta property="og:image" content="@ViewBag.Image" />

        <meta property="fb:app_id" content="">
        <meta property="business:contact_data:street_address" content="@Html.Raw(item.adress)">
        <meta property="business:contact_data:locality" content="@Html.Raw(item.city)">
        <meta property="business:contact_data:region" content="@Html.Raw(item.city)">
        <meta property="business:contact_data:postal_code" content="@Html.Raw(item.psc)">
        <meta property="business:contact_data:country_name" content="Slovakia">
        <meta property="business:contact_data:email" content="@Html.Raw(item.email)">
        <meta property="business:contact_data:phone_number" content="@Html.Raw(item.phone)">
        <meta property="business:contact_data:website" content="@Request.Url.ToString()">

        <title>@ViewBag.Title @Html.Raw(item.description)</title>

        <meta name="description" content="@ViewBag.Description" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        if (item.indexed == 1)
        {
            <meta name="robots" content="noindex">
        }

        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
        <link href="~/Content/fonts/icomoon/icons.css" rel="stylesheet">

        <link rel="stylesheet" href="~/Content/bootstrap.min.css" />
        <link rel="stylesheet" href="~/Content/style.css" />
        <link rel="stylesheet" href="~/Content/hp.css" />
        <link rel="stylesheet" href="~/Content/style-responsive.css" />
        <link rel="stylesheet" href="~/Content/megamenu.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
        <link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
        <link href="~/Content/product_slider.css" rel="stylesheet" />
        <link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
        <link rel="shortcut icon" type="image/png" href="~/Content/images/icon.png" />
        <link href="https://fonts.googleapis.com/css?family=Asap+Condensed:400,700|Asap:400,700&display=swap&subset=latin-ext" rel="stylesheet">
        <link href="~/Content/toastr.css" rel="stylesheet" />
        <link href="~/Lightbox/ekko-lightbox.css" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
        <script src="~/Scripts/modernizr-2.6.2.js"></script>
        <script src="~/Scripts/jquery.validate.js"></script>
        <script src="~/Scripts/jquery.validate-vsdoc.js"></script>
        <script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
        <script src="~/Scripts/tinymce/tinymce.min.js" type="text/javascript"></script>
        <script src="~/Scripts/bootstrap.min.js"></script>
        <script src="~/Scripts/toastr.js"></script>
        <script type="text/javascript" src="~/Scripts/instafeed.min.js" defer></script>
        <script src="https://www.google.com/recaptcha/api.js"></script>



        <!-- Google Analytics -->

        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '@item.googleanalyt', 'auto');
        ga('send', 'pageview');
        </script>
        <!-- End Google Analytics -->

        <script type="text/javascript">
            $(document).ready(function () {

                Number.prototype.toFixedNoRounding = function (n) {
                    const reg = new RegExp("^-?\\d+(?:\\.\\d{0," + n + "})?", "g")
                    const a = this.toString().match(reg)[0];
                    const dot = a.indexOf(".");
                    if (dot === -1) { // integer, insert decimal dot and pad up zeros
                        return a + "." + "0".repeat(n);
                    }
                    const b = n - (a.length - dot) + 1;
                    return b > 0 ? (a + "0".repeat(b)) : a;
                }

                $('#search').autocomplete({
                    minLength: 2,
                    source: '/hladat',
                    select: function (event, ui) {
                        $("#project").val(ui.item.label);
                        $("#project-id").val(ui.item.value);
                        $("#project-description").html(ui.item.desc);
                        $("#project-icon").attr("src", "images/" + ui.item.icon);

                        return false;
                    }
                })
                    .autocomplete("instance")._renderItem = function (ul, item) {
                        let cena = item.price + "€";
                        return $("<li>")
                            .append("<div><a href='/detail-produktu/" + item.id + "'><div style='width: 20%;display: inline-block;vertical-align: top;'><img src='/Uploads/" + item.image + "' width='50'></div><div style='width: 75%;display: inline-block;margin-left:10px;text-align:left;font-size: 14px;'><strong>" + item.title + "</strong><br><span style='font-size: 12px;'>" + cena + "</span></div></a></div>")
                            .appendTo(ul);
                    };
            });

        </script>

    }
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMLLRNP"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container-fluid w-75">
        <div class="row d-flex align-items-center header-top">
            <div class="col-lg-2 col-md-2 col-sm-12 col-12">
                <div class="row justify-content-between align-items-center">
                    <div class="col-lg-12 col-md-12 col-sm-4 col-4">
                        <a href="/">
                            <img class="logo" src="/Content/images/logo-nahod-sk.svg">
                        </a>
                    </div>
                    <div class="col-sm-8 col-8 d-block d-sm-block d-md-none d-lg-none">
                        <div class="row justify-content-end">
                            <div id="main col-sm-8 col-6 justify-content-end">
                                <button class="openbtn" onclick="openNav()">☰ Kategórie</button>
                            </div>

                            <div class="col-sm-4 col-6 cart d-flex align-items-center justify-content-end">
                                <a href="@Url.Action("Basket", "Home")">
                                    <i class="icon-fishing-net"></i>
                                    <span id="cart-qty" class="cart-qty">@cartitems</span>
                                    <span id="cart-total" class="cart-total">@cartsum.ToString("n2") €</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-4 col-sm-12 search">

                @using (Html.BeginForm("SearchProduct", "Home", FormMethod.Post, new { enctype = "multipart/form-data", id = "Myform", @class = "form-inline search" }))
                {
                    @Html.Editor("term", new { htmlAttributes = new { type = "search", id = "search", placeholder = "Vyhľadať produkt" } })
                }
            </div>


            <div class="col-lg-4 col-md-3 col-sm-12 info">
                <div class="row">
                    <div class="col-lg-6 d-md-none d-lg-flex align-items-center flex-wrap">
                        <div>
                            <i class="icon-phone"></i>
                            <span>+421 948 610 250</span>
                        </div>
                        <div>
                            <i class="icon-envelope"></i>
                            <span>info@nahod.sk</span>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-12 d-flex align-items-center">
                        @{
                            if (username != "")
                            {
                                <i class="icon-user"></i>
                                <span>
                                    Vitajte @username!<br>
                                    @if (role == "0")
                                    {
                                        <a href="/cms"><u>Administrácia</u></a><br>
                                    }
                                    <a href="@Url.Action("Account", "Home")"><u>Môj účet</u></a><br><a class="logout" href="@Url.Action("LogOut", "Admin")"><u>Odhlásiť sa</u></a>
                                </span>
                                <input type="hidden" name="userName" id="userName" value="@Session["username"]">
                                <input type="hidden" name="userId" id="userId" value="@Session["userid"]">

                            }
                            else
                            {
                                <i class="icon-user"></i>
                                <span><a href="#" class="login-modal">Prihlásiť sa</a> / <a href="#" class="register-modal">Registrovať</a></span>
                            }
                        }
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-3 d-md-flex d-sm-none d-none cart align-items-center">

                <a href="@Url.Action("Basket", "Home")">
                    <i class="icon-fishing-net"></i>
                    <span id="cart-qty" class="cart-qty">@cartitems</span>
                    <span id="cart-total" class="cart-total">@cartsum.ToString("n2") €</span>
                </a>
            </div>
        </div>

        <div class="row header-bottom navbar">
            <div class="col-md">
                @{
                    var cats = Model.CategoriesModel;
                    foreach (var cat in cats.Where(i => i.maincat == "Žiadna" && i.topcat == "Žiadna" && i.topcat2 == "Žiadna"))
                    {
                        <a href="/kat/@cat.slug">@cat.name</a>
                    }
                }

            </div>
        </div>
    </div>

    @RenderBody()

    <div class="container-fluid footer-wrapper">
        <div class="container-fluid w-75">
            <div class="row footer-top">
                <div class="col-md-3">
                    <h3>Nahod e-shop</h3>
                    <ul>
                        <li><a href="#">Môj účet</a></li>
                        <li><a href="#">Obchodné podmienky</a></li>
                        <li><a href="#">Ochrana osobných údajov</a></li>
                        <li><a href="#">Reklamácie</a></li>
                        <li><a href="#">Doprava</a></li>
                        <li><a href="#">Platba</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h3>Kontakty</h3>
                    <p>Andreja Hlinku 3044/14,</p>
                    <p>92601 Sereď</p>
                    <p class="mt-2"><span class="font-weight-bold">Telefón: </span><span>0948 610 250, 0911 350 400</span></p>
                    <p><span class="font-weight-bold">E-Mail: </span><span>info@nahod.sk</span></p>
                    <p class="font-weight-bold mt-2">Otváracie hodiny:</p>
                    <p>Po - Pia: od 8:00 - 18:00</p>
                    <p>Sobota: od 8:00 - 12:00</p>
                    <p>Nedeľa: zatvorené</p>
                    <br>

                    <a href="#"><img class="icon" src="~/Content/images/facebook-logo.svg"></a>
                    <a href="#"><img class="icon" src="~/Content/images/instagram-logo.svg"></a>
                    <a href="#"><img class="icon" src="~/Content/images/youtube.svg"></a>
                </div>
                <div class="col-md-3 col-6">
                    <img src="/Html/banner.png">
                </div>
                <div class="col-md-3 col-6">
                    <img src="/Html/banner.png">
                </div>
            </div>

            <div class="row footer-del">
                <div class="col-md-12"></div>
            </div>
            <div class="row footer-bottom">
                <div class="col-md-6 payment-gateways">
                    <img src="/Html/banner.png">
                    <img src="/Html/banner.png">
                    <img src="/Html/banner.png">
                </div>
                <div class="col-md-6 copyright">
                    HOBERTO 2021
                </div>
            </div>
        </div>
    </div>



    @{
        Html.RenderPartial("_LoginHeader");
        Html.RenderPartial("_RegisterHeader");
    }
    <div id="mySidebar" class="sidebar sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
        <a class="dropdown-btn sub_catsmenu"><h3 class="firstcat" style="color: #fff;padding: 20px 0 0;">Značky </h3></a><i style="margin-top: -33px;color:#fff" class="fa fa-caret-down dropdown-btn"></i>
        <div class="dropdown-container">

            @foreach (var brand in Model.BrandsModel.OrderBy(o => o.priority))
            {
                <a class="sub_catsmenu" href="@Url.Action("Brand", "Home", new {brand = @Html.Raw(brand.slug)})">
                    @brand.name
                </a>
            }

        </div>
        <a href="/kat/novinky" class="sub_catsmenu">
            <h3 style="padding:0;">Novinky</h3>
        </a>
        <a href="/kat/zlavy" class="sub_catsmenu">
            <h3 style="padding: 0;">Produkty v zľave</h3>
        </a>
        @foreach (var cat in Model.CategoriesModel.Where(i => i.maincat == "Žiadna"))
        {
            <a href="@Url.Action("Category", "Home", new {catslug = @Html.Raw(cat.slug)})" class="sub_catsmenu">
                <h3 class="firstcat">@Html.Raw(cat.name)</h3>
            </a>
            <ul>
                @foreach (var subcat in Model.CategoriesModel.Where(o => (o.maincat == cat.name && o.topcat == "") || (o.maincat == cat.name && o.topcat == "Žiadna")))
                {
                    var counter3 = 0;
                    var dropdowncounter = 0;
                    foreach (var isdropdown in Model.CategoriesModel.Where(o => o.topcat == subcat.name && o.maincat == cat.name))
                    {
                        dropdowncounter++;
                    }
                    if (dropdowncounter > 1)
                    {
                        <a class="dropdown-btn sub_catsmenu" style="color:#fff"><li><strong>@Html.Raw(subcat.name)</strong></li></a>

                        /*If is more than one element in menu*/
                        <i style="color:#fff" class="fa fa-caret-down dropdown-btn"></i>
                    }
                    else
                    {
                        <a href="@Url.Action("Category", "Home", new {catslug = @Html.Raw(cat.slug), subslug = @Html.Raw(subcat.slug)})" class="sub_catsmenu" style="color:#fff"><li><strong>@Html.Raw(subcat.name)</strong></li></a>

                    }
                    if (counter3 < 1)
                    {
                        <div class="dropdown-container">
                            @foreach (var subcat2 in Model.CategoriesModel.Where(o => o.topcat2 == subcat.name && o.topcat == cat.name))
                            {
                                <a href="@Url.Action("Category", "Home", new {catslug = @Html.Raw(cat.slug), subslug = @Html.Raw(subcat.slug), subslug2 = @Html.Raw(subcat2.slug)})" class="sub_catsmenu"><li>@Html.Raw(subcat2.name)</li></a>
                            }
                        </div>
                    }
                    counter3++;
                }

            </ul>
        }
    </div>

    <script>
        function onSubmit(token) {
            document.getElementById("Subscribeform").submit();
        }

        // Get the modal
        var modal = document.getElementById("myModal");
        var modalreg = document.getElementById("myModalReg");

        // Get the button that opens the modal
        var btn = document.getElementById("modalLogin");
        var btnreg = document.getElementById("modalReg");
        var btnreg2 = document.getElementById("modalRegister");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        var spanreg = document.getElementsByClassName("closereg")[0];

        // When the user clicks the button, open the modal
        if (btn !== null) {
            btn.onclick = function () {
                modal.style.display = "block";
            }
        }
        if (btnreg !== null) {
            btnreg.onclick = function () {
                modalreg.style.display = "block";
            }
        }
        if (btnreg2 !== null) {
            btnreg2.onclick = function () {
                modalreg.style.display = "block";
                modal.style.display = "none";
            }
        }
        // When the user clicks on <span> (x), close the modal
        if (span !== null) {
            span.onclick = function () {
                modal.style.display = "none";
            }
        }
        if (spanreg !== null) {
            spanreg.onclick = function () {
                modalreg.style.display = "none";
            }
        }
        // When the user clicks anywhere outside of the modal, close it
        if (window !== null) {
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
        if (window !== null) {
            window.onclick = function (event) {
                if (event.target == modalreg) {
                    modalreg.style.display = "none";
                }
            }
        }
    </script>
    <script>
        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
            document.getElementById("main").style.marginLeft = "250px";
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
        }

        jQuery(document).on('click',
            '.mega-dropdown',
            function (e) {
                e.stopPropagation()
            })
    </script>


    <script>
        $(document).ready(function () {
            $(".login-modal").click(function () {
                $("#myModal").css("display", "flex");
            });

            $(".register-modal").click(function () {
                $("#myModalReg").css("display", "flex");
            });

            $("#myModal .close").click(function () {
                $("#myModal").css("display", "none");
            });

            $("#myModalReg .closereg").click(function () {
                $("#myModalReg").css("display", "none");
            });
        });

    </script>

    @{
        if (Session["userid"] != null)
        {
            Entities db = new Entities();
            var userId = (int)Session["userid"];
            var userMeta = db.usersmeta.Where(i => i.userid == userId).FirstOrDefault();

            int rating = userMeta.rating;
            decimal sum = userMeta.sum;

            string actualDiscount = "";
            string nextDiscount = "";
            decimal remainingSum = 0;
            string discountLevel = "";

            switch (rating)
            {
                case 1:
                    actualDiscount = "5%";
                    nextDiscount = "10%";
                    remainingSum = 500 - sum;
                    discountLevel = "strieborným";

                    break;
                case 2:
                    actualDiscount = "10%";
                    nextDiscount = "15%";
                    remainingSum = 1000 - sum;
                    discountLevel = "zlatým";
                    break;

            }

            if (remainingSum > 0 && Request.QueryString["userLogin"] == "true")
            {
                <script>
                    $(document).ready(function () {
                        $loginStr = "Vaša aktuálna zlava je @actualDiscount. Nakúpte ešte za @remainingSum.ToString("N2") € a stanete sa @discountLevel zákazníkom a vaša zlava sa zvýši na @nextDiscount.";
                        toastr["success"]($loginStr);
                        toastr.options = {
                            "closeButton": true,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "15000",
                            "extendedTimeOut": "5000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                    });
                </script>
            }
        }
    }





</body>
</html>
