@model Cms.Models.BlogModel
@{
    Layout = "~/Views/Shared/_LayoutCms.cshtml";
    ViewBag.Title = "Editovať článok";
}

<h2>@ViewBag.Title</h2>
<br />
@using (Html.BeginForm("UploadImages", "Blog", FormMethod.Post, new { enctype = "multipart/form-data", id = "Myform" }))
{
   
        @Html.EditorFor(model => model.Id, new { htmlAttributes = new { @class = "form-control", style = "display:none !important;" } })
        @Html.EditorFor(model => model.Image, new { htmlAttributes = new { @class = "form-control", style = "display:none !important;", placeholder = "Pôvodná cena" } })

        <!-- This will contain your HtmlContent and use the TinyMCE editor-->
        <div class="form-group">
        <div class="row">
            <div class="col-md-3">
                <div class="col-md-14">
                    <img src="~/Uploads/@Html.DisplayTextFor(model => model.Image)" alt="@Html.DisplayTextFor(model => model.Title)" style="width: 100%;" />
                </div>
            </div>
            <div class="col">
                <div class="col-md-14 btnvyber">
                    <strong>@Html.LabelFor(model => model.TitleImage, "Zmeniť titulnú fotografiu", htmlAttributes: new { @class = "control-label col-md-12 vyberf" })</strong>
                    <small>Ideálny rozmer titulnej fotografie je 1110 x 550px (š x v).</small>
                    <br /><br />
                    <a id="btn_vis" style="cursor:pointer">Vyber fotografie</a>
                    @Html.TextBoxFor(model => model.TitleImage, "", new { @type = "file", @class = "form-control", @accept = "png|jpg|jpeg|gif", @style = "max-width: 67%;height:60px;display:none;", @id = "bttn", @onchange = "pressed()" })
                    <label id="fileLabel">Nie je vybratá žiadna fotografia.</label>
                    @Html.ValidationMessageFor(model => model.TitleImage, "", new { @class = "text-danger" })
                </div>
                <br />
                <div class="form-group">
                    <div>
                        <input type="submit" value="Nahrať novú titulnú fotografiu" class="btn btn-success" onclick="validateForm();" />
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<hr />
@using (Html.BeginForm("EditBlog", "Blog", FormMethod.Post, new { enctype = "multipart/form-data", id = "Myform" }))
{
    @Html.AntiForgeryToken()
    <div class="form-horizontal">
        <div class="col-md-5">
            @Html.EditorFor(m => m.Title, new { htmlAttributes = new { @class = "form-control", placeholder = "Nadpis", id = "categoryname" } })
        </div>
        <br />
        <div class="col-md-5">
            @Html.EditorFor(m => m.Slug, new { htmlAttributes = new { @class = "form-control", placeholder = "Slug", id = "slug", onclick = "createSlug()" } })
            @Html.ValidationMessageFor(m => m.Slug, "", new { @class = "text-danger" })
        </div>

        <br />
        <div class="col-md-12">
            @Html.EditorFor(m => m.Excerpt, new { htmlAttributes = new { @class = "form-control", placeholder = "Excerpt (krátky popis článku)" } })
        </div>
        <br />
        <div class="col-md-12">
            @Html.TextAreaFor(m => m.Content)
        </div>
    </div>
    <br />
    <div class="form-group">
        <div style="text-align: right">
            <input type="submit" value="Uložiť textové zmeny" class="btn btn-success" />
        </div>
    </div>
}
<hr />
@using (Html.BeginForm("UploadImages", "Blog", FormMethod.Post, new { enctype = "multipart/form-data", id = "Myform" }))
{
    @Html.AntiForgeryToken()
    <div class="form-group">
        @Html.EditorFor(model => model.Id, new { htmlAttributes = new { @class = "form-control", style = "display:none !important;", placeholder = "Pôvodná cena" } })
        @Html.EditorFor(model => model.Gallery, new { htmlAttributes = new { @class = "form-control hidden", style = "display:none !important;", placeholder = "Pôvodná cena" } })

        <strong>@Html.LabelFor(model => model.ImageGallery, "Pridať obrázky do fotogalérie", htmlAttributes: new { @class = "control-label col-md-8 vyberf" })</strong>
        <br /><br />
        <div class="col-md-14 btnvyber">
            <a id="bttn_vis" style="cursor:pointer">Vyber fotografie</a>
            @Html.TextBoxFor(model => model.ImageGallery, "", new { @type = "file", @class = "form-control", @multiple = "multiple", @accept = "png|jpg|jpeg|gif", @style = "max-width: 67%;height:60px;display:none;", @id = "btttn", @onchange = "press()" })
            <label id="fileLabell">Nie je vybratá žiadna fotografia.</label>
            @Html.ValidationMessageFor(model => model.ImageGallery, "", new { @class = "text-danger" })
        </div>
        <br />
    </div>
    <div class="form-group">
        <div>
            <input type="submit" value="Nahrať do galérie" class="btn btn-success" onclick="validateForm();" />
        </div>
    </div>
    <section id="galleria">
        <div class="jumbotron">
            @if (Directory.Exists(Server.MapPath("~/Uploads/" + @Html.DisplayTextFor(model => model.Gallery))))
            {
                foreach (var imgPath in Directory.GetFiles(Server.MapPath("~/Uploads/" + @Html.DisplayTextFor(model => model.Gallery))))
                {
                    var img = new FileInfo(imgPath);
                    <a href="@Url.Content(String.Format("~/Uploads/" + @Html.DisplayTextFor(model => model.Gallery) + "{0}", img.Name))" data-toggle="lightbox" data-gallery="example-gallery" style="padding:5px 1px 0 0;display: inline-block;width:24%;">
                        <img style="width:100%; height:250px;float:left;object-fit: cover;" src="@Url.Content(String.Format("~/Uploads/" + @Html.DisplayTextFor(model => model.Gallery) + "{0}", img.Name))" class="img-fluid" />
                    </a>
                    @Html.ActionLink(HttpUtility.HtmlDecode("&#215;"), "DeletePicture", new { url = String.Format("~/Uploads/" + @Html.DisplayTextFor(model => model.Gallery) + "{0}", img.Name), id = @Html.DisplayTextFor(model => model.Id) }, new { onclick = "return confirm('Naozaj chcete vymazať fotografiu?')", @class = "btn btn-danger", data_toggle = "tooltip", data_placement = "top", title = "Kliknutím nenávratne vymažete fotografiu.", style = "position: absolute; margin-left:-50px; margin-top: 5px;" })
                }
            }
            else
            { }
            <ul class="list-group" id="uploadedFiles"></ul>
        </div>
    </section>
}
<script type="text/javascript">
    // Initialize your tinyMCE Editor with your preferred options
    tinyMCE.init({
        // General options
        mode: "textareas",
        theme: "modern",
        branding: false,
        elementpath: false,
        height: 300,
        convert_fonts_to_spans: false,
        entity_encoding: "numeric",
        selector: "textarea",
        plugins:
            'print preview searchreplace autolink directionality visualblocks visualchars fullscreen link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists textcolor wordcount image contextmenu colorpicker textpattern help imagetools save insertdatetime preview media searchreplace print contextmenu paste directionality fullscreen noneditable visualchars nonbreaking template wordcount advlist autosave',
        toolbar1:
            'formatselect | bold italic strikethrough forecolor backcolor | link | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | removeformat | mybutton | upload',

        templates: [
            { title: 'Test template 1', content: 'Test 1' },
            { title: 'Test template 2', content: 'Test 2' }
        ],
        content_css: "/Content/Site.css",
        paste_data_images: false,
        images_upload_url: '/upload-image',
        images_upload_base_path: '/Uploads/images',
        setup: function (editor) {
            var inp = $('<input id="tinymce-uploader" type="file" name="pic" style="display:none">');
            $(editor.getElement()).parent().append(inp);

            inp.on("change",
                function () {
                    uploadFile($(this), editor);
                });

            editor.addButton('upload',
                {
                    text: "Nahrať PDF",
                    icon: false,
                    onclick: function (e) {
                        inp.trigger('click');
                    }
                });
        }
    });

    function uploadFile(inp, editor) {
        var input = inp.get(0);
        var data = new FormData();
        data.append('file', input.files[0]);

        $.ajax({
            url: '/upload-image',
            type: 'POST',
            data: data,
            processData: false, // Don't process the files
            contentType:
                false, // Set content type to false as jQuery will tell the server its a query string request
            success: function (data, textStatus, jqXHR) {
                editor.insertContent('<a target="_blank" class="content-img" href="/Uploads/images/' + data.location + '">Pomenuj svoje PDF. (Klikni pravým tlačidlom, stlač Link a uprav sekciu Text to display)</a>');
            },
            error: function (jqXHR, textStatus, errorThrown) {
                if (jqXHR.responseText) {
                    errors = JSON.parse(jqXHR.responseText).errors
                    alert('Error uploading image: ' +
                        errors.join(", ") +
                        '. Make sure the file is an image and has extension jpg/jpeg/png.');
                }
            }
        });
    }


</script>

<script src="/Scripts/umd/popper.min.js"></script>
<script src="/Scripts/bootstrap.min.js"></script>

<script src="http://malsup.github.com/jquery.form.js"></script>

<script>
    $("#btn_vis").click(function () {
        $("#bttn").trigger('click');
    });

    window.pressed = function () {
        var a = document.getElementById('bttn');
        if (a.files.length > 1) {
            fileLabel.innerHTML = "Boli vybraté " + a.files.length + " fotografie.";
        }
        else if (a.files.length = 1) {
            fileLabel.innerHTML = "Bola vybratá " + a.files.length + " fotografia.";
        }
    };

    $("#bttn_vis").click(function () {
        $("#btttn").trigger('click');
    });

    window.press = function () {
        var a = document.getElementById('btttn');
        if (a.files.length > 1) {
            fileLabell.innerHTML = "Boli vybraté " + a.files.length + " fotografie.";
        }
        else if (a.files.length = 1) {
            fileLabell.innerHTML = "Bola vybratá " + a.files.length + " fotografia.";
        }
    };

    function createSlug() {
        var catName = document.getElementById("categoryname").value;
        var newSlug = string_to_slug(catName);
        document.getElementById("slug").value = newSlug;
    }
    function string_to_slug(text) {
        text = text.toString().toLowerCase().trim();

        const sets = [
            { to: 'a', from: '[ÀÁÂÃÄÅÆĀĂĄẠẢẤẦẨẪẬẮẰẲẴẶ]' },
            { to: 'c', from: '[ÇĆĈČ]' },
            { to: 'd', from: '[ÐĎĐÞ]' },
            { to: 'e', from: '[ÈÉÊËĒĔĖĘĚẸẺẼẾỀỂỄỆ]' },
            { to: 'g', from: '[ĜĞĢǴ]' },
            { to: 'h', from: '[ĤḦ]' },
            { to: 'i', from: '[ÌÍÎÏĨĪĮİỈỊ]' },
            { to: 'j', from: '[Ĵ]' },
            { to: 'ij', from: '[Ĳ]' },
            { to: 'k', from: '[Ķ]' },
            { to: 'l', from: '[ĹĻĽŁ]' },
            { to: 'm', from: '[Ḿ]' },
            { to: 'n', from: '[ÑŃŅŇ]' },
            { to: 'o', from: '[ÒÓÔÕÖØŌŎŐỌỎỐỒỔỖỘỚỜỞỠỢǪǬƠ]' },
            { to: 'oe', from: '[Œ]' },
            { to: 'p', from: '[ṕ]' },
            { to: 'r', from: '[ŔŖŘ]' },
            { to: 's', from: '[ßŚŜŞŠ]' },
            { to: 't', from: '[ŢŤ]' },
            { to: 'u', from: '[ÙÚÛÜŨŪŬŮŰŲỤỦỨỪỬỮỰƯ]' },
            { to: 'w', from: '[ẂŴẀẄ]' },
            { to: 'x', from: '[ẍ]' },
            { to: 'y', from: '[ÝŶŸỲỴỶỸ]' },
            { to: 'z', from: '[ŹŻŽ]' },
            { to: '-', from: '[·/_,:;\']' }
        ];

        sets.forEach(set => {
            text = text.replace(new RegExp(set.from, 'gi'), set.to)
        });

        return text
            .replace(/\s+/g, '-')    // Replace spaces with -
            .replace(/[^\w-]+/g, '') // Remove all non-word chars
            .replace(/--+/g, '-')    // Replace multiple - with single -
            .replace(/^-+/, '')      // Trim - from start of text
            .replace(/-+$/, '')      // Trim - from end of text

    }
</script>